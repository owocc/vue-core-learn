{"version":3,"file":"vue.js","sources":["../src/observer/index.js","../src/initState.js","../src/init.js","../src/index.js"],"sourcesContent":["// 对数据进行劫持\n\n/* Note:\n    data中的数据可能是一个 普通的对象的值:           {name:'owo'}\n    也可能是一个对象中的对象:                       {user:{age:12}}\n    或者也可能是一个普通的数组也可能是数组中嵌套      {[1,2,3]} || {[{age:12},{age:14},{age:15}]}\n    当然数据也可能更复杂,就是一路嵌套进去\n    这里的最外层的 {} 都是指 data 返回的那个对象(( \n*/\n\nexport function observer(data) {\n    // 这里要判断数据是否不是 object\n    if (typeof data != 'object' || data == null) {\n        return data\n    }\n    // 处理对象的数据劫持\n    return new Observer(data)\n}\n\n// 对数据进行劫持\n// Observer 观察者\n// 在 vue2 中是使用 Object.defineProperty 来对数据进行劫持的,它有一个缺点就是只能对对象中的一个属性进行劫持(所以需要使用递归来进行数据的劫持)\nclass Observer {\n    constructor(value) {\n        this.walk(value)\n    }\n    walk(data) {\n        let keys = Object.keys(data) // 获取到对象的所有 key,方便等下用 Object.defineProperty 来设置代理\n        // 通过循环设置数据劫持 \n        for (let i = 0; i < keys.length; i++) {\n            let key = keys[i] // 得到对象中的一个键\n            let value = data[key] // value 表示传入的 data 对象对应的值(和key对应)\n            defineReactive(data,key,value)\n        }\n    }\n}\n/**\n * 对对象中的属性进行劫持\n * @param {*} data 需要进行数据劫持的对象\n * @param {*} key 需要劫持的键\n * @param {*} value 数据的值\n */\nfunction defineReactive(data,key,value){\n    Object.defineProperty(data,key,{\n        get(){\n            console.log('获取',key);\n            return value\n        },\n        //set 方法接收到的就是新设置的值\n        set(newValue){\n            // 判断新设置的值是否和当前的值一致,如果一致直接返回\n            if(newValue === value) return\n            // 如果不一致,就更新\n            console.log('update');\n            value = newValue\n        }\n    })\n}","import { observer } from \"./observer/index\"\n\n// 初始化状态\nexport function initState(vm) {\n    let opts = vm.$options\n    // 判断传入了哪些属性\n    if (opts.props) {\n        initProps()\n    }\n    if (opts.data) {\n        initData(vm)\n    }\n    if (opts.watch) {\n        initWatch()\n    }\n    if (opts.computed) {\n        initComputed()\n    }\n    if (opts.methods) {\n        initMethods()\n    }\n}\n\nfunction initProps() { }\n\nfunction initWatch() { }\nfunction initComputed() { }\nfunction initMethods() { }\n\n// 对 Data 进行初始化\nfunction initData(vm) {\n    let data = vm.$options.data\n    // 判断 data 是否是一个函数,如果是一个函数就将它执行,如果不是就返回 data 原有的值\n    // 这里需要修改下 this 的指向\n    data = vm._data = typeof data == \"function\" ? data.call(vm) : data\n    // --- 对 data 数据进行劫持 ---\n    observer(data)\n}","import { initState } from \"./initState\"\n\n// 初始化 Vue\nexport function initMixin(Vue) {\n\n    // 为 Vue 的原型链添加 _init 方法\n    Vue.prototype._init = function (options) {\n        console.log(options)\n        let vm = this // 创建一个快捷的变量指向当前 Vue 实例\n        vm.$options = options // 绑定快捷变量,方便后面访问\n        initState(vm) // 将当前的 Vue 实例传递给初始化状态\n    }\n}\n\n","import { initMixin } from \"./init\"\n\n/**\n * \n * @param {*} options Vue的选项 比如 props | data | watch ...等等\n */\nfunction Vue(options){\n    this._init(options)\n}\ninitMixin(Vue) // 初始化 Vue\nexport default Vue"],"names":["observer","data","_typeof","Observer","value","_classCallCheck","walk","_createClass","key","keys","Object","i","length","defineReactive","defineProperty","get","console","log","set","newValue","initState","vm","opts","$options","props","initData","watch","computed","methods","_data","call","initMixin","Vue","prototype","_init","options"],"mappings":"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"}